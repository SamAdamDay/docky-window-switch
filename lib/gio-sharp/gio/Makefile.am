include $(top_srcdir)/build.rules.mk

UNSAFE = -unsafe
DEBUG = -debug

SRCS = \
	$(srcdir)/AssemblyInfo.cs \
	$(srcdir)/FileFactory.cs \
	$(srcdir)/GioStream.cs

CUSTOMS = \
	$(srcdir)/AppInfoAdapter.custom \
	$(srcdir)/FileAdapter.custom \
	$(srcdir)/File.custom \
	$(srcdir)/FileEnumerator.custom	

SNK = 	$(srcdir)/snk

ASSEMBLIES = \
	-pkg:glib-sharp-2.0

all: gio-sharp.dll

gio-api.xml: $(srcdir)/gio-api.raw $(srcdir)/Gio.metadata
	@echo -e "\n*** Massaging the raw api into $@"
	cp $(srcdir)/gio-api.raw gio-api.xml
	chmod +w gio-api.xml
	$(GAPI2FIXUP) --api=gio-api.xml --metadata=$(srcdir)/Gio.metadata

$(top_builddir)/build/gapi_codegen.exe:
	$(MAKE) -C $(top_builddir)/lib/gio-sharp/generator

generated/File.cs: gio-api.xml $(CUSTOMS) $(top_builddir)/build/gapi_codegen.exe
	@echo -e "\n*** Generating C# code"
	$(MONO) $(top_builddir)/build/gapi_codegen.exe $(GLIB_SHARP_20_CFLAGS) --outdir=generated --customdir=$(srcdir) --generate gio-api.xml

gtk-sharp.snk: $(SNK)
	cp $< $@

gio-sharp.dll: generated/File.cs $(SRCS) gtk-sharp.snk
	@echo -e "\n*** Building $@"
	$(MCS) -target:library -out:$(top_builddir)/build/$@ $(UNSAFE) $(DEBUG) $(ASSEMBLIES) $(SRCS) generated/*.cs

assemblydir = $(pkglibdir)
assembly_DATA =	\
	gio-sharp.dll \
	gio-sharp.dll.config
